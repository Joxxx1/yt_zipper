# 🍪 Cookies设置指南

## 📋 概述

`cookies.txt` 文件是YouTube视频下载器的关键组件，用于绕过访问限制和下载高清视频。本指南将帮助您正确设置cookies文件。

## ⚠️ 重要提醒

- **隐私安全**: cookies.txt 包含您的登录信息，请妥善保管
- **不要分享**: 不要将您的cookies.txt文件分享给他人
- **定期更新**: cookies会定期过期，建议每周更新一次
- **仅供学习**: 本工具仅供学习和研究使用

## 🔧 获取cookies.txt的方法

### 方法1：使用浏览器扩展（推荐）

#### Chrome浏览器
1. **安装扩展**：
   - 打开 [Chrome网上应用店](https://chrome.google.com/webstore/detail/get-cookiestxt-locally/cclelndahbckbenkjhflpdbgdldlbecc)
   - 搜索 "Get cookies.txt LOCALLY"
   - 点击"添加至Chrome"

2. **获取cookies**：
   - 访问 [YouTube](https://www.youtube.com)
   - 确保已登录您的Google账户
   - 点击扩展图标（在浏览器右上角）
   - 选择"Export"导出cookies.txt文件

#### Firefox浏览器
1. **安装扩展**：
   - 打开 [Firefox附加组件](https://addons.mozilla.org/en-US/firefox/addon/cookies-txt/)
   - 搜索 "cookies.txt"
   - 点击"添加到Firefox"

2. **获取cookies**：
   - 访问YouTube并登录
   - 点击扩展图标
   - 导出cookies.txt文件

### 方法2：手动创建

1. **登录YouTube**：
   - 打开浏览器访问 [YouTube](https://www.youtube.com)
   - 使用Google账户登录

2. **打开开发者工具**：
   - 按 `F12` 或右键选择"检查"
   - 切换到"Application"或"存储"标签

3. **找到Cookies**：
   - 在左侧找到"Cookies"
   - 点击 "https://www.youtube.com"

4. **导出cookies**：
   - 复制所有cookies信息
   - 按照Netscape格式保存为cookies.txt

### 方法3：使用Python脚本

创建一个自动获取cookies的脚本：

```python
# get_cookies.py
import browser_cookie3
import http.cookiejar

def export_cookies():
    """导出YouTube cookies到cookies.txt文件"""
    try:
        # 获取Chrome浏览器的cookies
        cookies = browser_cookie3.chrome(domain_name='.youtube.com')
        
        # 创建cookies.txt文件
        with open('cookies.txt', 'w', encoding='utf-8') as f:
            f.write('# Netscape HTTP Cookie File\n')
            f.write('# https://curl.se/rfc/cookie_spec.html\n')
            f.write('# This file was generated by get_cookies.py\n\n')
            
            for cookie in cookies:
                # 检查是否是YouTube相关的cookie
                if 'youtube.com' in cookie.domain or 'google.com' in cookie.domain:
                    f.write(f'{cookie.domain}\tTRUE\t{cookie.path}\t'
                           f'{"TRUE" if cookie.secure else "FALSE"}\t{cookie.expires}\t'
                           f'{cookie.name}\t{cookie.value}\n')
        
        print("✅ cookies.txt 文件已成功创建！")
        return True
        
    except Exception as e:
        print(f"❌ 获取cookies失败: {e}")
        print("💡 请确保已登录YouTube并安装了browser_cookie3库")
        return False

if __name__ == "__main__":
    # 安装依赖：pip install browser_cookie3
    export_cookies()
```

## 📁 文件格式

cookies.txt 文件应按照Netscape格式保存：

```
# Netscape HTTP Cookie File
# https://curl.se/rfc/cookie_spec.html
# This file was generated by browser extension

.youtube.com	TRUE	/	FALSE	1735689600	VISITOR_INFO1_LIVE	abc123
.youtube.com	TRUE	/	FALSE	1735689600	LOGIN_INFO	xyz789
.google.com	TRUE	/	FALSE	1735689600	SID	123456
```

### 格式说明
- 第1列：域名
- 第2列：是否包含子域名（TRUE/FALSE）
- 第3列：路径
- 第4列：是否安全连接（TRUE/FALSE）
- 第5列：过期时间（Unix时间戳）
- 第6列：cookie名称
- 第7列：cookie值

## 🔍 验证cookies.txt文件

创建文件后，可以验证其有效性：

```python
# verify_cookies.py
def verify_cookies():
    """验证cookies.txt文件"""
    try:
        with open('cookies.txt', 'r', encoding='utf-8') as f:
            content = f.read()
            
        # 检查是否包含YouTube相关cookies
        if 'youtube.com' in content:
            print("✅ cookies.txt 文件格式正确")
            print("✅ 包含YouTube cookies")
            return True
        else:
            print("⚠️ cookies.txt 文件可能不包含YouTube cookies")
            return False
            
    except FileNotFoundError:
        print("❌ 未找到cookies.txt文件")
        return False
    except Exception as e:
        print(f"❌ 验证失败: {e}")
        return False

if __name__ == "__main__":
    verify_cookies()
```

## 📝 使用步骤

### 1. 获取cookies.txt文件
使用上述任一方法获取cookies.txt文件

### 2. 放置文件
- 将 `cookies.txt` 文件放在项目根目录
- 与 `enhanced_downloader.py` 在同一文件夹

### 3. 验证文件
```bash
python verify_cookies.py
```

### 4. 开始下载
```bash
python quick_start.py
```

## 🛠️ 故障排除

### 常见问题

**Q: cookies.txt文件无效怎么办？**
A: 确保文件格式正确，包含YouTube相关cookies，并且已登录YouTube。

**Q: 下载时提示cookies错误？**
A: 重新获取cookies.txt文件，确保包含最新的登录信息。

**Q: cookies文件过期怎么办？**
A: cookies会定期过期，需要重新获取。建议每周更新一次。

**Q: 无法获取cookies？**
A: 确保已登录YouTube，尝试使用不同的浏览器或扩展。

### 错误代码
- `FileNotFoundError`: cookies.txt文件不存在
- `ValueError`: cookies文件格式错误
- `PermissionError`: 文件权限问题

## 🔒 安全建议

1. **文件保护**：
   - 不要将cookies.txt文件上传到公共仓库
   - 在.gitignore中忽略cookies.txt文件
   - 定期删除旧的cookies文件

2. **账户安全**：
   - 使用专门的测试账户
   - 定期更换密码
   - 启用两步验证

3. **使用限制**：
   - 仅用于学习和研究
   - 遵守YouTube服务条款
   - 不要用于商业用途

## 📊 文件大小参考

- 正常的cookies.txt文件大小：1-10KB
- 包含的cookies数量：10-50个
- 主要包含的域名：youtube.com, google.com

## 🎯 最佳实践

1. **定期更新**：每周更新一次cookies文件
2. **备份管理**：保留多个版本的cookies文件
3. **测试验证**：每次更新后测试下载功能
4. **错误记录**：记录cookies相关的错误信息

---

**💡 提示**: 正确设置cookies.txt文件是成功下载高清视频的关键！
